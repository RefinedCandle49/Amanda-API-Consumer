<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Consulta de Envío</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>Consulta de Envío</h1>
<form id="consultaForm">
    <label for="idEnvio">ID del Envío:</label>
    <input type="text" id="idEnvio" name="idEnvio">
    <button type="submit">Consultar</button>
</form>


<div id="contenedor-envio">
    <form id="form-editar-envio" method="post">
        <!-- Campos editables -->
        <label for="idGuia">
            <strong>ID Guía:</strong>
            <input type="text" id="idGuia" name="idGuia">
        </label>
        
        
        <label for="origen">
            <strong>Origen:</strong>
            <input type="text" id="origen" name="origen">
        </label>
        
        
        <label for="destino">
            <strong>Destino:</strong>
            <input type="text" id="destino" name="destino">
        </label>
        
        
        <label for="estado">
            <strong>Estado:</strong>
            <input type="text" id="estado" name="estado">
        </label>
        
        
        <label for="observaciones">
            <strong>Observaciones:</strong>
            <textarea id="observaciones" name="observaciones"></textarea>
        </label>
        
        <input type="submit" value="Actualizar">
    
    </form>
</div>


<h3>Interior del paquete</h3>
<div id="contenedor-detalle">
    <!-- Campos editables -->
    <label for="idRemitente">
        <strong>ID Remitente:</strong>
        <input type="text" id="idRemitente" name="idRemitente">
    </label>
    
    <label for="nombreRemitente">
        <strong>Nombre Remitente:</strong>
        <input type="text" id="nombreRemitente" name="nombreRemitente">
    </label>
    
    
    <label for="dniRemitente">
        <strong>DNI Remitente:</strong>
        <input type="text" id="dniRemitente" name="dniRemitente">
    </label>
    
    
    <label for="telefonoRemitente">
        <strong>Teléfono Remitente:</strong>
        <input type="text" id="telefonoRemitente" name="telefonoRemitente">
    </label>
    
    
    <label for="nombreDestinatario">
        <strong>Nombre Destinatario:</strong>
        <input type="text" id="nombreDestinatario" name="nombreDestinatario">
    </label>
    
    
    <label for="direccionDestinatario">
        <strong>Dirección Destinatario:</strong>
        <input type="text" id="direccionDestinatario" name="direccionDestinatario">
    </label>
    
    
    <label for="telefonoDestinatario">
        <strong>Teléfono Destinatario:</strong>
        <input type="text" id="telefonoDestinatario" name="telefonoDestinatario">
    </label>
    
    
    <label for="idPaquete">
        <strong>ID Paquete:</strong>
        <input type="text" id="idPaquete" name="idPaquete">
    </label>
    
    
    <label for="pesoPaquete">
        <strong>Peso Paquete:</strong>
        <input type="text" id="pesoPaquete" name="pesoPaquete">
    </label>
    
    
    <label for="medidasPaquete">
        <strong>Medidas Paquete:</strong>
        <input type="text" id="medidasPaquete" name="medidasPaquete">
    </label>
    
</div>


<script>
    function obtenerToken() {
        return new Promise(function (resolve, reject) {
            $.ajax({
                url: "http://localhost:8080/usuario/autenticar",
                method: "POST",
                data: JSON.stringify({
                    username: "Kevin",
                    password: "12345"
                }),
                contentType: "application/json",

                success: function (token) {
                    resolve(token);
                },
                error: function (error) {
                    reject(error);
                }
            });
        });
    }

    function actualizarEnvio() {
        obtenerToken().then(function (token) {
            var data = {
                idGuia: $('#idGuia').val(),
                origen: $('#origen').val(),
                destino: $('#destino').val(),
                estado: $('#estado').val(),
                observaciones: $('#observaciones').val()
            };

            $.ajax({
                url: "http://localhost:8080/envio/actualizar",
                method: "PUT",
                data: JSON.stringify(data),
                contentType: "application/json",
                headers: {
                    "Authorization": "Bearer " + token
                },

                success: function (respuesta) {
                    console.log(respuesta);
                    parent.location.href = "test.html";
                },
                error: function (error) {
                    console.error(error);

                }
            });
        });
    }

    $('#form-editar-envio').on('submit', function (event) {
        event.preventDefault();
        actualizarEnvio();
    });


    function consultarEnvio() {
        $('#consultaForm').submit(function (event) {
            event.preventDefault();
            var idEnvio = $('#idEnvio').val();
            obtenerToken().then(function (token) {
                $.ajax({
                    url: "http://localhost:8080/envio/listar/" + idEnvio,
                    method: "GET",
                    headers: {
                        "Authorization": "Bearer " + token
                    },
                    success: function (datos) {
                        mostrarDatosEnvio(datos[0]);
                    }
                });
            });
        });
    }

    function mostrarDatosEnvio(datos) {
        $('#idGuia').val(datos.idGuia);
        $('#origen').val(datos.origen);
        $('#destino').val(datos.destino);
        $('#estado').val(datos.estado);
        $('#observaciones').val(datos.observaciones || '');
        $('#idRemitente').val(datos.remitente.idRemitente);
        $('#nombreRemitente').val(datos.remitente.nombreRemitente);
        $('#dniRemitente').val(datos.remitente.dniRemitente);
        $('#telefonoRemitente').val(datos.remitente.telefono);
        $('#nombreDestinatario').val(datos.destinatario.nombreDestinatario);
        $('#direccionDestinatario').val(datos.destinatario.direccion);
        $('#telefonoDestinatario').val(datos.destinatario.telefono);
        $('#idPaquete').val(datos.paquete.idPaquete);
        $('#pesoPaquete').val(datos.paquete.peso);
        $('#medidasPaquete').val(datos.paquete.medidas);
    }


    $(document).ready(function () {
        // Llama a la función consultarEnvio cuando se cargue la página
        consultarEnvio();
    });
</script>
<!--<script src="envio.js"></script>-->
</body>
</html>
